//send email module
var nodemailer = require('nodemailer');

var emailTransport = function(setting) {
  this.setting = setting;
  this.transporter = null;
  // for sending email using gmail 
  this.transporter = nodemailer.createTransport(
    'smtps://' + setting.username +'%40gmail.com:' + setting.password + '@smtp.gmail.com');
};

/*
  use SMTP to send email
    emailItem format:
    {
      to: 'test@example.com,
      subject: 'meeting agenda',
      content: 'email content',
      isHtml: false
    }
    code example:
    app.mailer.send(email_obj, function(error, info) {})
 */
emailTransport.prototype.send = function(emailItem, callback) {
  var mailOption = {
    from: this.setting.sender,
    to: emailItem.to,
    subject: emailItem.subject
  };
  if (emailItem.isHtml) {
    mailOption.html = emailItem.content;
  } else {
    mailOption.text = emailItem.content;
  }
  this.transporter.sendMail(mailOption, callback);
};

exports.Engine = emailTransport;

